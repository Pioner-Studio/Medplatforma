{% extends "base.html" %} {% block content %}
<div class="container-fluid">
  <h2 class="mb-4">Переводы между кассами</h2>

  <!-- Текущие балансы касс -->
  <div class="row mb-4">
    {% for source_id, data in cashboxes.items() %}
    <div class="col-md-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">{{ data.name }}</h5>
          <p class="card-text display-6">
            {{ "{:,.0f}".format(data.balance) }}₽
          </p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Форма перевода -->
  <div class="row">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h4>Новый перевод</h4>
        </div>
        <div class="card-body">
          <form
            method="post"
            action="{{ url_for('transfer.transfer_execute') }}"
          >
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="from_source" class="form-label"
                  >Из какой кассы</label
                >
                <select
                  class="form-select"
                  id="from_source"
                  name="from_source"
                  required
                >
                  <option value="">Выберите кассу</option>
                  {% for source_id, source_name in sources.items() %}
                  <option value="{{ source_id }}">
                    {{ source_name }} ({{
                    "{:,.0f}".format(cashboxes[source_id].balance) }}₽)
                  </option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-md-6 mb-3">
                <label for="to_source" class="form-label">В какую кассу</label>
                <select
                  class="form-select"
                  id="to_source"
                  name="to_source"
                  required
                >
                  <option value="">Выберите кассу</option>
                  {% for source_id, source_name in sources.items() %}
                  <option value="{{ source_id }}">{{ source_name }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="amount" class="form-label"
                  >Сумма перевода (₽)</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="amount"
                  name="amount"
                  min="1"
                  step="0.01"
                  required
                />
              </div>

              <div class="col-md-6 mb-3">
                <label for="operation_date" class="form-label"
                  >Дата операции</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="operation_date"
                  name="operation_date"
                  value="{{ today }}"
                  required
                />
              </div>
            </div>

            <div class="mb-3">
              <label for="comment" class="form-label">Комментарий</label>
              <textarea
                class="form-control"
                id="comment"
                name="comment"
                rows="2"
                placeholder="Опционально"
              ></textarea>
            </div>

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">
                Выполнить перевод
              </button>
              <a
                href="{{ url_for('transfer.transfer_history') }}"
                class="btn btn-outline-secondary"
              >
                История переводов
              </a>
              <a href="/finance" class="btn btn-outline-secondary">
                К финансам
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="alert alert-info">
        <h5>Как это работает</h5>
        <ul class="mb-0">
          <li>Деньги списываются с одной кассы</li>
          <li>Автоматически зачисляются на другую</li>
          <li>Балансы обновляются мгновенно</li>
          <li>Все переводы логируются</li>
          <li>Можно указать дату операции</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
