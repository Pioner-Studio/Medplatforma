{% extends "base.html" %} {% set page_title = "Пациенты" %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Список пациентов</h2>
  <div class="btn-toolbar">
    <div class="btn-group me-2">
      <a href="/patients/import" class="btn btn-outline-primary">
        <i class="fas fa-upload"></i> Импорт
      </a>
    </div>

    <div class="btn-group dropdown me-2">
      <button
        class="btn btn-outline-success dropdown-toggle"
        type="button"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        <i class="fas fa-download"></i> Экспорт
      </button>
      <ul class="dropdown-menu">
        <li>
          <a class="dropdown-item" href="/api/patients/export/csv">
            <i class="fas fa-file-csv"></i> CSV файл
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="/api/patients/export/excel">
            <i class="fas fa-file-excel"></i> Excel файл
          </a>
        </li>
      </ul>
    </div>

    <div class="btn-group">
      <a href="/add_patient" class="btn btn-primary">
        <i class="fas fa-plus"></i> Добавить пациента
      </a>
    </div>
  </div>
</div>

<!-- Поиск пациентов -->
<div class="row mb-4">
  <div class="col-md-6">
    <div class="input-group">
      <input
        type="text"
        class="form-control"
        id="patientSearch"
        placeholder="Поиск по имени, телефону или email"
      />
      <button class="btn btn-outline-secondary" type="button">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </div>
</div>

<!-- Список пациентов -->
{% if patients %}
<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Имя</th>
            <th>Телефон</th>
            <th>Email</th>
            <th>Дата рождения</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for patient in patients %}
          <tr>
            <td><strong>{{ patient.full_name }}</strong></td>
            <td>{{ patient.phone or '—' }}</td>
            <td>{{ patient.email or '—' }}</td>
            <td>{{ patient.birth_date or '—' }}</td>
            <td>
              <a
                href="/patients/{{ patient._id }}"
                class="btn btn-sm btn-outline-primary"
              >
                <i class="fas fa-eye"></i> Карта
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% else %}
<div class="text-center py-5">
  <i class="fas fa-users fa-3x text-muted mb-3"></i>
  <h4 class="text-muted">Пациенты не найдены</h4>
  <p class="text-muted">Добавьте первого пациента для начала работы</p>
</div>
{% endif %}

<script>
  // Поиск пациентов
  document
    .getElementById("patientSearch")
    .addEventListener("input", function (e) {
      const searchTerm = e.target.value.toLowerCase();
      const rows = document.querySelectorAll("tbody tr");

      rows.forEach((row) => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? "" : "none";
      });
    });
</script>
{% endblock %}
