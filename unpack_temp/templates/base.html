<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="version" content="1759666691">
    <title>{% block title %}Medplatforma{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    {% block head %}{% endblock %}
</head>
<body class="">
  <div class="layout">
    <aside class="sidebar">
      {% include 'sidebar.html' %}
    </aside>
    <div class="main-area">
      {% include 'topbar.html' %}

<main class="content">
        {% block content %}{% endblock %}
      </main>
    </div>
  </div>

  {% block scripts %}
  <script>
    // Открытие меню профиля
    function toggleProfileMenu() {
      let menu = document.getElementById('profileMenu');
      menu.style.display = (menu.style.display === 'flex' ? 'none' : 'flex');
    }
    window.onclick = function(e) {
      let menu = document.getElementById('profileMenu');
      if (menu && e.target.closest('.profile-block') == null && e.target.closest('.profile-menu') == null) {
        menu.style.display = 'none';
      }
    };

    // --- Переключатель темы ---
    document.addEventListener("DOMContentLoaded", function() {
      const themeBtn = document.getElementById('themeToggleBtn');
      if (themeBtn) {
        themeBtn.onclick = function() {
          const sun = this.querySelector('.theme-sun');
          const moon = this.querySelector('.theme-moon');
          const body = document.body;
          if (sun && sun.style.display !== 'none') {
            sun.style.display = 'none';
            moon.style.display = 'inline';
            body.classList.add('dark-theme');
          } else {
            if (sun) sun.style.display = 'inline';
            if (moon) moon.style.display = 'none';
            body.classList.remove('dark-theme');
          }
        };
      }
    });
    // Можно добавить сохранение выбора темы в localStorage, если надо.
  </script>
  {% endblock %}
  <script>
// Меню профиля (safe)
(function(){
  const toggle = () => {
    const menu = document.getElementById('profileMenu');
    if (!menu) return;
    menu.style.display = (menu.style.display === 'flex' ? 'none' : 'flex');
  };
  window.toggleProfileMenu = toggle;
  window.addEventListener('click', (e) => {
    const menu = document.getElementById('profileMenu');
    if (!menu) return;
    if (!e.target.closest('.profile-block') && !e.target.closest('.profile-menu')) {
      menu.style.display = 'none';
    }
  });
})();
document.addEventListener('DOMContentLoaded', function() {
  const themeBtn = document.getElementById('themeToggleBtn');
  if (!themeBtn) return;
  const sunIcon = document.querySelector('.theme-sun');
  const moonIcon = document.querySelector('.theme-moon');
  if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark-theme');
    if (sunIcon)  sunIcon.style.display = 'none';
    if (moonIcon) moonIcon.style.display = 'inline';
  }
  themeBtn.addEventListener('click', function() {
    const dark = document.body.classList.toggle('dark-theme');
    if (sunIcon)  sunIcon.style.display  = dark ? 'none'   : 'inline';
    if (moonIcon) moonIcon.style.display = dark ? 'inline' : 'none';
    localStorage.setItem('theme', dark ? 'dark' : 'light');
  });
});
</script>

<script>
// Выделение активного пункта меню
document.addEventListener('DOMContentLoaded', function() {
    const currentPath = window.location.pathname;
    const menuLinks = document.querySelectorAll('.nav-link, .sidebar a');

    menuLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && currentPath.startsWith(href) && href !== '/') {
            link.classList.add('active');
            link.style.background = 'rgba(255,255,255,0.1)';
        }
    });
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>