# –ê–†–•–ò–í –û–®–ò–ë–û–ö –ò –†–ï–®–ï–ù–ò–ô
*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–π –≤ –ø—Ä–æ–µ–∫—Ç–µ –º–µ–¥–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã*

---

## üîß –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –≠–¢–û–¢ –ê–†–•–ò–í

1. **–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏** - —Å–Ω–∞—á–∞–ª–∞ –∏—â–∏—Ç–µ –ø–æ—Ö–æ–∂—É—é –ø—Ä–æ–±–ª–µ–º—É –∑–¥–µ—Å—å
2. **–ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –Ω–æ–≤–æ–π –ø—Ä–æ–±–ª–µ–º—ã** - –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª
3. **–§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏:**
   ```
   ### –û—à–∏–±–∫–∞: [–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
   **–°–∏–º–ø—Ç–æ–º:** —á—Ç–æ –≤–∏–¥–µ–ª–∏
   **–ü—Ä–∏—á–∏–Ω–∞:** –≤ —á—ë–º –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞
   **–†–µ—à–µ–Ω–∏–µ:** –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª–∏
   **–î–∞—Ç–∞:** –∫–æ–≥–¥–∞ –ø—Ä–æ–∏–∑–æ—à–ª–æ
   ```

---

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–û—à–∏–±–∫–∏ Flask/Python](#flask-python)
2. [–û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö MongoDB](#mongodb)
3. [–û—à–∏–±–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤ Jinja2](#templates)
4. [–ü—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏](#imports)
5. [–ü—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#architecture)

---

## 1. FLASK/PYTHON

### –û—à–∏–±–∫–∞: 'metrics' is undefined
**–°–∏–º–ø—Ç–æ–º:** `jinja2.exceptions.UndefinedError: 'metrics' is undefined` –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
**–ü—Ä–∏—á–∏–Ω–∞:** Context processor –¥–æ–±–∞–≤–ª–µ–Ω –î–û —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ `app` –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `db`
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `@app.context_processor` –ü–û–°–õ–ï —Å—Ç—Ä–æ–∫–∏ `db = client[DB_NAME]` (—Å—Ç—Ä–æ–∫–∞ 280+)
2. Context processor –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Å–ª–µ `app.config["USERS_COLLECTION"] = db["users"]`
**–î–∞—Ç–∞:** 26.09.2025

### –û—à–∏–±–∫–∞: IndentationError –≤ main.py
**–°–∏–º–ø—Ç–æ–º:** `IndentationError: expected an indented block after 'if' statement`
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –ø–æ—Å–ª–µ `if not doc.get("card_no"):`
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å 4 –ø—Ä–æ–±–µ–ª–∞ (–∏–ª–∏ 1 —Ç–∞–±) –ø–µ—Ä–µ–¥ `doc["card_no"] = make_card_no()`
**–î–∞—Ç–∞:** 26.09.2025

### –û—à–∏–±–∫–∞: NameError - 'app' is not defined
**–°–∏–º–ø—Ç–æ–º:** `NameError: name 'app' is not defined` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª—è
**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@app.route` –î–û —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ Flask
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è `app = Flask(__name__)` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞
**–î–∞—Ç–∞:** 26.09.2025

---

## 2. MONGODB

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
**–°–∏–º–ø—Ç–æ–º:** –ù–æ–≤—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ `card_no`
**–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `make_card_no()` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞
**–†–µ—à–µ–Ω–∏–µ:**
1. –í —Ñ—É–Ω–∫—Ü–∏–∏ `add_patient()` (—Å—Ç—Ä–æ–∫–∞ ~3574): –∑–∞–º–µ–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é seq –Ω–∞ `"card_no": make_card_no()`
2. –í —Ñ—É–Ω–∫—Ü–∏–∏ `api_patients_create()` (—Å—Ç—Ä–æ–∫–∞ ~4191): –¥–æ–±–∞–≤–∏—Ç—å `if not doc.get("card_no"): doc["card_no"] = make_card_no()`
**–î–∞—Ç–∞:** 26.09.2025

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—è medical_questionnaire –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —É —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
**–°–∏–º–ø—Ç–æ–º:** KeyError –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ `patient['medical_questionnaire']`
**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î –Ω–µ –∏–º–µ—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–Ω–∫–µ—Ç—ã
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ `python update_patients_questionnaire.py`
**–î–∞—Ç–∞:** 25.09.2025

---

## 3. TEMPLATES (JINJA2)

### –û—à–∏–±–∫–∞: Cannot open patient_questionnaire.html
**–°–∏–º–ø—Ç–æ–º:** `FINDSTR: Cannot open patient_questionnaire.html` + `UndefinedError`
**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª —à–∞–±–ª–æ–Ω–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω
**–†–µ—à–µ–Ω–∏–µ:**
1. `New-Item -Path "templates\patient_questionnaire.html" -ItemType File -Force`
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–∞ –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª
**–î–∞—Ç–∞:** 26.09.2025

### –ü—Ä–æ–±–ª–µ–º–∞: –î–æ—Å—Ç—É–ø –∫ –≤–ª–æ–∂–µ–Ω–Ω—ã–º –ø–æ–ª—è–º —Å–ª–æ–≤–∞—Ä—è –≤ —à–∞–±–ª–æ–Ω–µ
**–°–∏–º–ø—Ç–æ–º:** `'dict' object has no attribute 'medical_questionnaire'`
**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ—á–µ—á–Ω–æ–π –Ω–æ—Ç–∞—Ü–∏–∏ `patient.medical_questionnaire` –≤–º–µ—Å—Ç–æ –º–µ—Ç–æ–¥–∞ `.get()`
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `patient.get('medical_questionnaire', {})` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `questionnaire` –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é –∏–∑ view
**–î–∞—Ç–∞:** 26.09.2025

---

## 4. IMPORTS

### –ü—Ä–æ–±–ª–µ–º–∞: Circular imports
**–°–∏–º–ø—Ç–æ–º:** `ImportError: cannot import name 'X' from partially initialized module`
**–ü—Ä–∏—á–∏–Ω–∞:** –í–∑–∞–∏–º–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
**–†–µ—à–µ–Ω–∏–µ:**
- –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–∑—Ä—ã–≤–∞ —Ü–∏–∫–ª–æ–≤
- –†–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª–µ–π
**–î–∞—Ç–∞:** (–ø—Ä–∏–º–µ—Ä –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–ª—É—á–∞–µ–≤)

---

## 5. ARCHITECTURE

### –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç metrics –≤–æ –≤—Å–µ—Ö render_template
**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∞ `'metrics' is undefined` –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
**–ü—Ä–∏—á–∏–Ω–∞:** –ö–∞–∂–¥–∞—è view-—Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å metrics –≤—Ä—É—á–Ω—É—é
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å context processor –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è metrics –≤–æ –≤—Å–µ —à–∞–±–ª–æ–Ω—ã
**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥:**
```python
@app.context_processor
def inject_metrics():
    try:
        total_rooms = db.rooms.count_documents({})
        now = datetime.utcnow()
        busy_rooms = db.appointments.count_documents({
            "start": {"$lte": now},
            "end": {"$gte": now}
        })
        free_rooms = max(0, total_rooms - busy_rooms)
        return {"metrics": {"total_rooms": total_rooms, "free_rooms": free_rooms}}
    except:
        return {"metrics": {"total_rooms": 0, "free_rooms": 0}}
```
**–í–∞–∂–Ω–æ:** –†–∞–∑–º–µ—â–∞—Ç—å –ü–û–°–õ–ï –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `db`
**–î–∞—Ç–∞:** 26.09.2025

---

## üìù –®–ê–ë–õ–û–ù –î–õ–Ø –ù–û–í–´–• –ó–ê–ü–ò–°–ï–ô

```markdown
### –û—à–∏–±–∫–∞: [–Ω–∞–∑–≤–∞–Ω–∏–µ]
**–°–∏–º–ø—Ç–æ–º:**
**–ü—Ä–∏—á–∏–Ω–∞:**
**–†–µ—à–µ–Ω–∏–µ:**
**–ö–æ–¥ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
```python
# –∫–æ–¥ —Ä–µ—à–µ–Ω–∏—è
```
**–î–∞—Ç–∞:**
```

---

## üîç –ß–ê–°–¢–´–ï –ü–ê–¢–¢–ï–†–ù–´ –û–®–ò–ë–û–ö

### –ü–∞—Ç—Ç–µ—Ä–Ω 1: –ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
**–ü—Ä–∞–≤–∏–ª–æ:** –í—Å–µ–≥–¥–∞ —Å–æ–±–ª—é–¥–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫:
1. –ò–º–ø–æ—Ä—Ç—ã
2. `app = Flask(__name__)`
3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è app
4. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (`db = ...`)
5. Context processors
6. Blueprints
7. Routes

### –ü–∞—Ç—Ç–µ—Ä–Ω 2: –†–∞–±–æ—Ç–∞ —Å MongoDB —Å–ª–æ–≤–∞—Ä—è–º–∏
**–ü—Ä–∞–≤–∏–ª–æ:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.get()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:
- ‚ùå `patient['field']` - —É–ø–∞–¥—ë—Ç –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—è
- ‚úÖ `patient.get('field', default)` - –≤–µ—Ä–Ω—ë—Ç default –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—è

### –ü–∞—Ç—Ç–µ—Ä–Ω 3: –®–∞–±–ª–æ–Ω—ã Jinja2
**–ü—Ä–∞–≤–∏–ª–æ:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
- ‚ùå `{{ patient.field }}`
- ‚úÖ `{{ patient.get('field', '‚Äî') }}`
- ‚úÖ `{% if patient.get('field') %}...{% endif %}`

---

## üí° –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´ –î–õ–Ø –û–¢–õ–ê–î–ö–ò

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
```python
python -c "from main import db; print('–ü–∞—Ü–∏–µ–Ω—Ç—ã:', db.patients.count_documents({}))"
```

### –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–¥–µ
```bash
findstr /N "def function_name" main.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—Ç—É–ø–æ–≤ –≤ Python
```bash
python -m py_compile main.py
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä–æ–∫ —Ñ–∞–π–ª–∞
```bash
python -c "with open('main.py', 'r', encoding='utf-8') as f: lines = f.readlines(); print(''.join(lines[START:END]))"
```

---

## üìö –†–ï–°–£–†–°–´

- [Flask –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://flask.palletsprojects.com/)
- [Jinja2 —à–∞–±–ª–æ–Ω—ã](https://jinja.palletsprojects.com/)
- [MongoDB Python –¥—Ä–∞–π–≤–µ—Ä](https://pymongo.readthedocs.io/)
- [–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª –ø—Ä–æ–µ–∫—Ç–∞](–†–ê–ë–û–ß–ò–ô%20–ü–†–û–¢–û–ö–û–õ.md)

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 26.09.2025*
