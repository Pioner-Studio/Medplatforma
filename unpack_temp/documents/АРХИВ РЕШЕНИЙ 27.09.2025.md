# –ê–†–•–ò–í –†–ï–®–ï–ù–ò–ô 27.09.2025

## –ü–†–û–ë–õ–ï–ú–ê: –î–≤–∞ –ø—Ä–∞–π—Å–∞ –¥–ª—è —É—Å–ª—É–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏

**–î–∞—Ç–∞:** 27.09.2025
**–í—Ä–µ–º—è:** 22:00-23:30

### –°–∏–º–ø—Ç–æ–º—ã:
- –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —É—Å–ª—É–≥–∏ –ø–æ–ª–µ "–õ—å–≥–æ—Ç–Ω–∞—è —Ü–µ–Ω–∞" –±—ã–ª–æ –ø—É—Å—Ç—ã–º
- employee_price –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–æ—Å—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –ò–º–ø–æ—Ä—Ç —Å–æ–∑–¥–∞–≤–∞–ª —É—Å–ª—É–≥–∏, –Ω–æ Flask –∏—Ö –Ω–µ –≤–∏–¥–µ–ª

### –ü—Ä–∏—á–∏–Ω–∞:
**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –†–∞–∑–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

1. **Flask (main.py)** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –æ–±–ª–∞—á–Ω—É—é MongoDB Atlas:
   ```
   MONGO_URI=mongodb+srv://medadmin:...@medplatforma.cnv7fbo.mongodb.net/
   ```

2. **–°–∫—Ä–∏–ø—Ç—ã –∏–º–ø–æ—Ä—Ç–∞** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ª–æ–∫–∞–ª—å–Ω—É—é MongoDB:
   ```python
   client = MongoClient("mongodb://localhost:27017/")
   ```

3. –†–µ–∑—É–ª—å—Ç–∞—Ç:
   - –ò–º–ø–æ—Ä—Ç –∑–∞–ø–∏—Å—ã–≤–∞–ª –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î üíª
   - Flask —á–∏—Ç–∞–ª –∏–∑ –æ–±–ª–∞—á–Ω–æ–π –ë–î ‚òÅÔ∏è
   - –î–∞–Ω–Ω—ã–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–ª–∏

### –†–µ—à–µ–Ω–∏–µ:

#### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (main.py, —Å—Ç—Ä–æ–∫–∞ 3260-3285)
```python
def _service_form_data():
    # ...
    employee_price = request.form.get("employee_price") or ""

    # –í–∞–ª–∏–¥–∞—Ü–∏—è –ª—å–≥–æ—Ç–Ω–æ–π —Ü–µ–Ω—ã –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    emp_price = None
    if employee_price:
        try:
            emp_price = int(employee_price)
            if emp_price < 0:
                errors.append("–õ—å–≥–æ—Ç–Ω–∞—è —Ü–µ–Ω–∞ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π.")
        except ValueError:
            errors.append("–õ—å–≥–æ—Ç–Ω–∞—è —Ü–µ–Ω–∞ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º.")

    data = {
        # ...
        "employee_price": emp_price,
        # ...
    }
```

#### 2. –û–±–Ω–æ–≤–ª–µ–Ω—ã —à–∞–±–ª–æ–Ω—ã
- `templates/edit_service.html` - –ø–æ–ª–µ `employee_price`
- `templates/add_service.html` - –ø–æ–ª–µ `employee_price`

#### 3. –°–æ–∑–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞
**–§–∞–π–ª:** `replace_services_dual_prices_fixed.py`

–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```python
from dotenv import load_dotenv
import os

load_dotenv()
MONGO_URI = os.getenv("MONGO_URI")  # –ß–∏—Ç–∞–µ—Ç –∏–∑ .env

client = MongoClient(MONGO_URI)  # –¢–∞ –∂–µ –ë–î —á—Ç–æ —É Flask
db = client['medplatforma']
```

#### 4. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ 55 —É—Å–ª—É–≥ —Å –¥–≤—É–º—è –ø—Ä–∞–π—Å–∞–º–∏
- price - –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–Ω–∞ (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)
- employee_price - –ª—å–≥–æ—Ç–Ω–∞—è —Ü–µ–Ω–∞ (–¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤/–¥—Ä—É–∑–µ–π)

### –°—Ç–∞—Ç—É—Å: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ - –ø–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚úÖ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π - —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ - —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï –î–õ–Ø –ë–£–î–£–©–ò–• –†–ê–ë–û–¢

### –ü–†–ò–ù–¶–ò–ü: –í–°–Å –ß–¢–û –ú–ï–ù–Ø–ï–ú - –í–û–ó–í–†–ê–©–ê–ï–ú –ù–ê –ú–ï–°–¢–û

**–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º:**

1. **–°–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:
   ```powershell
   copy main.py main.py.backup
   ```

2. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ —Ñ–∞–π–ª–µ —Å –¥–∞—Ç–æ–π:
   ```
   documents/–ê–†–•–ò–í –ò–ó–ú–ï–ù–ï–ù–ò–ô [–î–ê–¢–ê].md
   ```

3. **–§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å:**
   - –ö–∞–∫–æ–π —Ñ–∞–π–ª –∏–∑–º–µ–Ω—ë–Ω
   - –ö–∞–∫–∏–µ —Å—Ç—Ä–æ–∫–∏
   - –ß—Ç–æ –±—ã–ª–æ –î–û
   - –ß—Ç–æ —Å—Ç–∞–ª–æ –ü–û–°–õ–ï
   - –ó–∞—á–µ–º –∏–∑–º–µ–Ω–∏–ª–∏

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º:
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–ª–æ—Å—å

5. **–û—Ç–∫–∞—Ç—ã–≤–∞—Ç—å** –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:
   ```powershell
   copy main.py.backup main.py
   ```

### –®–∞–±–ª–æ–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```markdown
## –ò–ó–ú–ï–ù–ï–ù–ò–ï: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
**–§–∞–π–ª:** [–ø—É—Ç—å –∫ —Ñ–∞–π–ª—É]
**–°—Ç—Ä–æ–∫–∏:** [–Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫]

**–ë–´–õ–û:**
```python
[—Å—Ç–∞—Ä—ã–π –∫–æ–¥]
```

**–°–¢–ê–õ–û:**
```python
[–Ω–æ–≤—ã–π –∫–æ–¥]
```

**–ü—Ä–∏—á–∏–Ω–∞:** [–∑–∞—á–µ–º –∏–∑–º–µ–Ω–∏–ª–∏]
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** [–∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏]
```

### –§–∞–π–ª—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- main.py (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥)
- routes_finance.py (—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –º–æ–¥—É–ª—å)
- templates/*.html (—à–∞–±–ª–æ–Ω—ã)
- .env (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–º–ø–æ—Ä—Ç–∞/–º–∏–≥—Ä–∞—Ü–∏–∏

---

## –ê–†–•–ò–¢–ï–ö–¢–£–†–ê: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π

### –ù–æ–≤–æ–µ –ø–æ–ª–µ –≤ services:
```
services: {
  _id,
  name,
  code,
  price,              // –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∞–π—Å
  employee_price,     // –ª—å–≥–æ—Ç–Ω—ã–π –ø—Ä–∞–π—Å –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
  duration_min,
  is_active,
  color,
  description
}
```

### –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ª—å–≥–æ—Ç–Ω–æ–π —Ü–µ–Ω—ã:

**–§–∞–π–ª:** routes_finance.py (—Å—Ç—Ä–æ–∫–∞ 238-239)

```python
if use_preferential and svc.get("employee_price"):
    amount = int(svc.get("employee_price", 0) or 0)
else:
    amount = int(svc.get("price", 0) or 0)
```

**–£—Å–ª–æ–≤–∏–µ:** –ü–∞—Ü–∏–µ–Ω—Ç –∏–º–µ–µ—Ç –≥–∞–ª–æ—á–∫—É `use_preferential_pricing: true` –≤ –∫–∞—Ä—Ç–æ—á–∫–µ

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
1. –ü–∞—Ü–∏–µ–Ω—Ç —Å –≥–∞–ª–æ—á–∫–æ–π "–õ—å–≥–æ—Ç–Ω—ã–π –ø—Ä–∞–π—Å"
2. –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —É—Å–ª—É–≥–æ–π
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ `patient.use_preferential_pricing`
4. –ï—Å–ª–∏ true ‚Üí –±–µ—Ä—ë—Ç—Å—è `service.employee_price`
5. –ï—Å–ª–∏ false ‚Üí –±–µ—Ä—ë—Ç—Å—è `service.price`

---

## –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª—É–≥ –≤ –æ–±–ª–∞—á–Ω–æ–π –ë–î:
```powershell
python -c "from main import db; from dotenv import load_dotenv; load_dotenv(); svc = db.services.find_one({'name': 'ICON'}); print(f'price: {svc.get(\"price\")}'); print(f'employee_price: {svc.get(\"employee_price\")}')"
```

### –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∏–º–ø–æ—Ä—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
```powershell
python replace_services_dual_prices_fixed.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:
```powershell
python -c "from dotenv import load_dotenv; import os; load_dotenv(); print(os.getenv('MONGO_URI')[:30] + '...')"
```

---

## –£–†–û–ö–ò –ù–ê –ë–£–î–£–©–ï–ï

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î** –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .env –¥–ª—è –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤**, –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–æ–π –∂–µ –ë–î** —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è
5. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å DEBUG –≤—ã–≤–æ–¥** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º
6. **–î–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** –ø–µ—Ä–µ–¥ –±–æ–ª—å—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

---

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: 98% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –±–æ–µ–≤–æ–º—É –∑–∞–ø—É—Å–∫—É** üöÄ
