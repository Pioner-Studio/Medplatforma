    1: """ Functions for converting from DOS to UNIX line endings
    2: 
    3: """
    4: import os
    5: import re
    6: import sys
    7: 
    8: 
    9: def dos2unix(file):
   10:     "Replace CRLF with LF in argument files.  Print names of changed files."
   11:     if os.path.isdir(file):
   12:         print(file, "Directory!")
   13:         return
   14: 
   15:     with open(file, "rb") as fp:
   16:         data = fp.read()
   17:     if '\0' in data:
   18:         print(file, "Binary!")
   19:         return
   20: 
   21:     newdata = re.sub("\r\n", "\n", data)
   22:     if newdata != data:
   23:         print('dos2unix:', file)
   24:         with open(file, "wb") as f:
   25:             f.write(newdata)
   26:         return file
   27:     else:
   28:         print(file, 'ok')
   29: 
   30: def dos2unix_one_dir(modified_files, dir_name, file_names):
   31:     for file in file_names:
   32:         full_path = os.path.join(dir_name, file)
   33:         file = dos2unix(full_path)
   34:         if file is not None:
   35:             modified_files.append(file)
   36: 
   37: def dos2unix_dir(dir_name):
   38:     modified_files = []
   39:     os.path.walk(dir_name, dos2unix_one_dir, modified_files)
   40:     return modified_files
   41: #----------------------------------
   42: 
   43: def unix2dos(file):
   44:     "Replace LF with CRLF in argument files.  Print names of changed files."
   45:     if os.path.isdir(file):
   46:         print(file, "Directory!")
   47:         return
   48: 
   49:     with open(file, "rb") as fp:
   50:         data = fp.read()
   51:     if '\0' in data:
   52:         print(file, "Binary!")
   53:         return
   54:     newdata = re.sub("\r\n", "\n", data)
   55:     newdata = re.sub("\n", "\r\n", newdata)
   56:     if newdata != data:
   57:         print('unix2dos:', file)
   58:         with open(file, "wb") as f:
   59:             f.write(newdata)
   60:         return file
   61:     else:
   62:         print(file, 'ok')
   63: 
   64: def unix2dos_one_dir(modified_files, dir_name, file_names):
   65:     for file in file_names:
   66:         full_path = os.path.join(dir_name, file)
   67:         unix2dos(full_path)
   68:         if file is not None:
   69:             modified_files.append(file)
   70: 
   71: def unix2dos_dir(dir_name):
   72:     modified_files = []
   73:     os.path.walk(dir_name, unix2dos_one_dir, modified_files)
   74:     return modified_files
   75: 
   76: if __name__ == "__main__":
   77:     dos2unix_dir(sys.argv[1])
