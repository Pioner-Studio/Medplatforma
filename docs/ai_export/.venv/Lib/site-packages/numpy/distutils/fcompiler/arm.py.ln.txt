    1: import sys
    2: 
    3: from numpy.distutils.fcompiler import FCompiler, dummy_fortran_file
    4: from sys import platform
    5: from os.path import join, dirname, normpath
    6: 
    7: compilers = ['ArmFlangCompiler']
    8: 
    9: import functools
   10: 
   11: class ArmFlangCompiler(FCompiler):
   12:     compiler_type = 'arm'
   13:     description = 'Arm Compiler'
   14:     version_pattern = r'\s*Arm.*version (?P<version>[\d.-]+).*'
   15: 
   16:     ar_exe = 'lib.exe'
   17:     possible_executables = ['armflang']
   18: 
   19:     executables = {
   20:         'version_cmd': ["", "--version"],
   21:         'compiler_f77': ["armflang", "-fPIC"],
   22:         'compiler_fix': ["armflang", "-fPIC", "-ffixed-form"],
   23:         'compiler_f90': ["armflang", "-fPIC"],
   24:         'linker_so': ["armflang", "-fPIC", "-shared"],
   25:         'archiver': ["ar", "-cr"],
   26:         'ranlib':  None
   27:     }
   28: 
   29:     pic_flags = ["-fPIC", "-DPIC"]
   30:     c_compiler = 'arm'
   31:     module_dir_switch = '-module '  # Don't remove ending space!
   32: 
   33:     def get_libraries(self):
   34:         opt = FCompiler.get_libraries(self)
   35:         opt.extend(['flang', 'flangrti', 'ompstub'])
   36:         return opt
   37: 
   38:     @functools.lru_cache(maxsize=128)
   39:     def get_library_dirs(self):
   40:         """List of compiler library directories."""
   41:         opt = FCompiler.get_library_dirs(self)
   42:         flang_dir = dirname(self.executables['compiler_f77'][0])
   43:         opt.append(normpath(join(flang_dir, '..', 'lib')))
   44: 
   45:         return opt
   46: 
   47:     def get_flags(self):
   48:         return []
   49: 
   50:     def get_flags_free(self):
   51:         return []
   52: 
   53:     def get_flags_debug(self):
   54:         return ['-g']
   55: 
   56:     def get_flags_opt(self):
   57:         return ['-O3']
   58: 
   59:     def get_flags_arch(self):
   60:         return []
   61: 
   62:     def runtime_library_dir_option(self, dir):
   63:         return '-Wl,-rpath=%s' % dir
   64: 
   65: 
   66: if __name__ == '__main__':
   67:     from distutils import log
   68:     log.set_verbosity(2)
   69:     from numpy.distutils import customized_fcompiler
   70:     print(customized_fcompiler(compiler='armflang').get_version())
