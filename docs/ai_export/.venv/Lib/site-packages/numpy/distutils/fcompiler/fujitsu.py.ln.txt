    1: """
    2: fujitsu
    3: 
    4: Supports Fujitsu compiler function.
    5: This compiler is developed by Fujitsu and is used in A64FX on Fugaku.
    6: """
    7: from numpy.distutils.fcompiler import FCompiler
    8: 
    9: compilers = ['FujitsuFCompiler']
   10: 
   11: class FujitsuFCompiler(FCompiler):
   12:     compiler_type = 'fujitsu'
   13:     description = 'Fujitsu Fortran Compiler'
   14: 
   15:     possible_executables = ['frt']
   16:     version_pattern = r'frt \(FRT\) (?P<version>[a-z\d.]+)'
   17:     # $ frt --version
   18:     # frt (FRT) x.x.x yyyymmdd
   19: 
   20:     executables = {
   21:         'version_cmd'  : ["<F77>", "--version"],
   22:         'compiler_f77' : ["frt", "-Fixed"],
   23:         'compiler_fix' : ["frt", "-Fixed"],
   24:         'compiler_f90' : ["frt"],
   25:         'linker_so'    : ["frt", "-shared"],
   26:         'archiver'     : ["ar", "-cr"],
   27:         'ranlib'       : ["ranlib"]
   28:         }
   29:     pic_flags = ['-KPIC']
   30:     module_dir_switch = '-M'
   31:     module_include_switch = '-I'
   32: 
   33:     def get_flags_opt(self):
   34:         return ['-O3']
   35:     def get_flags_debug(self):
   36:         return ['-g']
   37:     def runtime_library_dir_option(self, dir):
   38:         return f'-Wl,-rpath={dir}'
   39:     def get_libraries(self):
   40:         return ['fj90f', 'fj90i', 'fjsrcinfo']
   41: 
   42: if __name__ == '__main__':
   43:     from distutils import log
   44:     from numpy.distutils import customized_fcompiler
   45:     log.set_verbosity(2)
   46:     print(customized_fcompiler('fujitsu').get_version())
