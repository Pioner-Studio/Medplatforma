    1: import os
    2: from distutils.core import Command
    3: from distutils.ccompiler import new_compiler
    4: from numpy.distutils.misc_util import get_cmd
    5: 
    6: class install_clib(Command):
    7:     description = "Command to install installable C libraries"
    8: 
    9:     user_options = []
   10: 
   11:     def initialize_options(self):
   12:         self.install_dir = None
   13:         self.outfiles = []
   14: 
   15:     def finalize_options(self):
   16:         self.set_undefined_options('install', ('install_lib', 'install_dir'))
   17: 
   18:     def run (self):
   19:         build_clib_cmd = get_cmd("build_clib")
   20:         if not build_clib_cmd.build_clib:
   21:             # can happen if the user specified `--skip-build`
   22:             build_clib_cmd.finalize_options()
   23:         build_dir = build_clib_cmd.build_clib
   24: 
   25:         # We need the compiler to get the library name -> filename association
   26:         if not build_clib_cmd.compiler:
   27:             compiler = new_compiler(compiler=None)
   28:             compiler.customize(self.distribution)
   29:         else:
   30:             compiler = build_clib_cmd.compiler
   31: 
   32:         for l in self.distribution.installed_libraries:
   33:             target_dir = os.path.join(self.install_dir, l.target_dir)
   34:             name = compiler.library_filename(l.name)
   35:             source = os.path.join(build_dir, name)
   36:             self.mkpath(target_dir)
   37:             self.outfiles.append(self.copy_file(source, target_dir)[0])
   38: 
   39:     def get_outputs(self):
   40:         return self.outfiles
