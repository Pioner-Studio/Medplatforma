    1: """Test deprecation and future warnings.
    2: 
    3: """
    4: import io
    5: import textwrap
    6: 
    7: import pytest
    8: 
    9: import numpy as np
   10: from numpy.ma.core import MaskedArrayFutureWarning
   11: from numpy.ma.testutils import assert_equal
   12: from numpy.testing import assert_warns
   13: 
   14: 
   15: class TestArgsort:
   16:     """ gh-8701 """
   17:     def _test_base(self, argsort, cls):
   18:         arr_0d = np.array(1).view(cls)
   19:         argsort(arr_0d)
   20: 
   21:         arr_1d = np.array([1, 2, 3]).view(cls)
   22:         argsort(arr_1d)
   23: 
   24:         # argsort has a bad default for >1d arrays
   25:         arr_2d = np.array([[1, 2], [3, 4]]).view(cls)
   26:         result = assert_warns(
   27:             np.ma.core.MaskedArrayFutureWarning, argsort, arr_2d)
   28:         assert_equal(result, argsort(arr_2d, axis=None))
   29: 
   30:         # should be no warnings for explicitly specifying it
   31:         argsort(arr_2d, axis=None)
   32:         argsort(arr_2d, axis=-1)
   33: 
   34:     def test_function_ndarray(self):
   35:         return self._test_base(np.ma.argsort, np.ndarray)
   36: 
   37:     def test_function_maskedarray(self):
   38:         return self._test_base(np.ma.argsort, np.ma.MaskedArray)
   39: 
   40:     def test_method(self):
   41:         return self._test_base(np.ma.MaskedArray.argsort, np.ma.MaskedArray)
   42: 
   43: 
   44: class TestMinimumMaximum:
   45: 
   46:     def test_axis_default(self):
   47:         # NumPy 1.13, 2017-05-06
   48: 
   49:         data1d = np.ma.arange(6)
   50:         data2d = data1d.reshape(2, 3)
   51: 
   52:         ma_min = np.ma.minimum.reduce
   53:         ma_max = np.ma.maximum.reduce
   54: 
   55:         # check that the default axis is still None, but warns on 2d arrays
   56:         result = assert_warns(MaskedArrayFutureWarning, ma_max, data2d)
   57:         assert_equal(result, ma_max(data2d, axis=None))
   58: 
   59:         result = assert_warns(MaskedArrayFutureWarning, ma_min, data2d)
   60:         assert_equal(result, ma_min(data2d, axis=None))
   61: 
   62:         # no warnings on 1d, as both new and old defaults are equivalent
   63:         result = ma_min(data1d)
   64:         assert_equal(result, ma_min(data1d, axis=None))
   65:         assert_equal(result, ma_min(data1d, axis=0))
   66: 
   67:         result = ma_max(data1d)
   68:         assert_equal(result, ma_max(data1d, axis=None))
   69:         assert_equal(result, ma_max(data1d, axis=0))
   70: 
   71: 
   72: class TestFromtextfile:
   73:     def test_fromtextfile_delimitor(self):
   74:         # NumPy 1.22.0, 2021-09-23
   75: 
   76:         textfile = io.StringIO(textwrap.dedent(
   77:             """
   78:             A,B,C,D
   79:             'string 1';1;1.0;'mixed column'
   80:             'string 2';2;2.0;
   81:             'string 3';3;3.0;123
   82:             'string 4';4;4.0;3.14
   83:             """
   84:         ))
   85: 
   86:         with pytest.warns(DeprecationWarning):
   87:             result = np.ma.mrecords.fromtextfile(textfile, delimitor=';')
