    1: """
    2: Test machar. Given recent changes to hardcode type data, we might want to get
    3: rid of both MachAr and this test at some point.
    4: 
    5: """
    6: import numpy._core.numerictypes as ntypes
    7: from numpy import array, errstate
    8: from numpy._core._machar import MachAr
    9: 
   10: 
   11: class TestMachAr:
   12:     def _run_machar_highprec(self):
   13:         # Instantiate MachAr instance with high enough precision to cause
   14:         # underflow
   15:         try:
   16:             hiprec = ntypes.float96
   17:             MachAr(lambda v: array(v, hiprec))
   18:         except AttributeError:
   19:             # Fixme, this needs to raise a 'skip' exception.
   20:             "Skipping test: no ntypes.float96 available on this platform."
   21: 
   22:     def test_underlow(self):
   23:         # Regression test for #759:
   24:         # instantiating MachAr for dtype = np.float96 raises spurious warning.
   25:         with errstate(all='raise'):
   26:             try:
   27:                 self._run_machar_highprec()
   28:             except FloatingPointError as e:
   29:                 msg = f"Caught {e} exception, should not have been raised."
   30:                 raise AssertionError(msg)
