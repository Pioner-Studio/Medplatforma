    1: """Application data stored by virtualenv."""
    2: 
    3: from __future__ import annotations
    4: 
    5: import logging
    6: import os
    7: 
    8: from platformdirs import user_data_dir
    9: 
   10: from .na import AppDataDisabled
   11: from .read_only import ReadOnlyAppData
   12: from .via_disk_folder import AppDataDiskFolder
   13: from .via_tempdir import TempAppData
   14: 
   15: LOGGER = logging.getLogger(__name__)
   16: 
   17: 
   18: def _default_app_data_dir(env):
   19:     key = "VIRTUALENV_OVERRIDE_APP_DATA"
   20:     if key in env:
   21:         return env[key]
   22:     return user_data_dir(appname="virtualenv", appauthor="pypa")
   23: 
   24: 
   25: def make_app_data(folder, **kwargs):
   26:     is_read_only = kwargs.pop("read_only")
   27:     env = kwargs.pop("env")
   28:     if kwargs:  # py3+ kwonly
   29:         msg = "unexpected keywords: {}"
   30:         raise TypeError(msg)
   31: 
   32:     if folder is None:
   33:         folder = _default_app_data_dir(env)
   34:     folder = os.path.abspath(folder)
   35: 
   36:     if is_read_only:
   37:         return ReadOnlyAppData(folder)
   38: 
   39:     if not os.path.isdir(folder):
   40:         try:
   41:             os.makedirs(folder)
   42:             LOGGER.debug("created app data folder %s", folder)
   43:         except OSError as exception:
   44:             LOGGER.info("could not create app data folder %s due to %r", folder, exception)
   45: 
   46:     if os.access(folder, os.W_OK):
   47:         return AppDataDiskFolder(folder)
   48:     LOGGER.debug("app data folder %s has no write access", folder)
   49:     return TempAppData()
   50: 
   51: 
   52: __all__ = (
   53:     "AppDataDisabled",
   54:     "AppDataDiskFolder",
   55:     "ReadOnlyAppData",
   56:     "TempAppData",
   57:     "make_app_data",
   58: )
