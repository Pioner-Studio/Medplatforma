    1: from __future__ import annotations
    2: 
    3: from typing import Final
    4: 
    5: magic: Final = (
    6:     b"\x00\x00\x00\x00\x00\x00\x00\x00"
    7:     b"\x00\x00\x00\x00\xc2\xea\x81\x60"
    8:     b"\xb3\x14\x11\xcf\xbd\x92\x08\x00"
    9:     b"\x09\xc7\x31\x8c\x18\x1f\x10\x11"
   10: )
   11: 
   12: align_1_checker_value: Final = b"3"
   13: align_1_offset: Final = 32
   14: align_1_length: Final = 1
   15: align_1_value: Final = 4
   16: u64_byte_checker_value: Final = b"3"
   17: align_2_offset: Final = 35
   18: align_2_length: Final = 1
   19: align_2_value: Final = 4
   20: endianness_offset: Final = 37
   21: endianness_length: Final = 1
   22: platform_offset: Final = 39
   23: platform_length: Final = 1
   24: encoding_offset: Final = 70
   25: encoding_length: Final = 1
   26: dataset_offset: Final = 92
   27: dataset_length: Final = 64
   28: file_type_offset: Final = 156
   29: file_type_length: Final = 8
   30: date_created_offset: Final = 164
   31: date_created_length: Final = 8
   32: date_modified_offset: Final = 172
   33: date_modified_length: Final = 8
   34: header_size_offset: Final = 196
   35: header_size_length: Final = 4
   36: page_size_offset: Final = 200
   37: page_size_length: Final = 4
   38: page_count_offset: Final = 204
   39: page_count_length: Final = 4
   40: sas_release_offset: Final = 216
   41: sas_release_length: Final = 8
   42: sas_server_type_offset: Final = 224
   43: sas_server_type_length: Final = 16
   44: os_version_number_offset: Final = 240
   45: os_version_number_length: Final = 16
   46: os_maker_offset: Final = 256
   47: os_maker_length: Final = 16
   48: os_name_offset: Final = 272
   49: os_name_length: Final = 16
   50: page_bit_offset_x86: Final = 16
   51: page_bit_offset_x64: Final = 32
   52: subheader_pointer_length_x86: Final = 12
   53: subheader_pointer_length_x64: Final = 24
   54: page_type_offset: Final = 0
   55: page_type_length: Final = 2
   56: block_count_offset: Final = 2
   57: block_count_length: Final = 2
   58: subheader_count_offset: Final = 4
   59: subheader_count_length: Final = 2
   60: page_type_mask: Final = 0x0F00
   61: # Keep "page_comp_type" bits
   62: page_type_mask2: Final = 0xF000 | page_type_mask
   63: page_meta_type: Final = 0x0000
   64: page_data_type: Final = 0x0100
   65: page_mix_type: Final = 0x0200
   66: page_amd_type: Final = 0x0400
   67: page_meta2_type: Final = 0x4000
   68: page_comp_type: Final = 0x9000
   69: page_meta_types: Final = [page_meta_type, page_meta2_type]
   70: subheader_pointers_offset: Final = 8
   71: truncated_subheader_id: Final = 1
   72: compressed_subheader_id: Final = 4
   73: compressed_subheader_type: Final = 1
   74: text_block_size_length: Final = 2
   75: row_length_offset_multiplier: Final = 5
   76: row_count_offset_multiplier: Final = 6
   77: col_count_p1_multiplier: Final = 9
   78: col_count_p2_multiplier: Final = 10
   79: row_count_on_mix_page_offset_multiplier: Final = 15
   80: column_name_pointer_length: Final = 8
   81: column_name_text_subheader_offset: Final = 0
   82: column_name_text_subheader_length: Final = 2
   83: column_name_offset_offset: Final = 2
   84: column_name_offset_length: Final = 2
   85: column_name_length_offset: Final = 4
   86: column_name_length_length: Final = 2
   87: column_data_offset_offset: Final = 8
   88: column_data_length_offset: Final = 8
   89: column_data_length_length: Final = 4
   90: column_type_offset: Final = 14
   91: column_type_length: Final = 1
   92: column_format_text_subheader_index_offset: Final = 22
   93: column_format_text_subheader_index_length: Final = 2
   94: column_format_offset_offset: Final = 24
   95: column_format_offset_length: Final = 2
   96: column_format_length_offset: Final = 26
   97: column_format_length_length: Final = 2
   98: column_label_text_subheader_index_offset: Final = 28
   99: column_label_text_subheader_index_length: Final = 2
  100: column_label_offset_offset: Final = 30
  101: column_label_offset_length: Final = 2
  102: column_label_length_offset: Final = 32
  103: column_label_length_length: Final = 2
  104: rle_compression: Final = b"SASYZCRL"
  105: rdc_compression: Final = b"SASYZCR2"
  106: 
  107: compression_literals: Final = [rle_compression, rdc_compression]
  108: 
  109: # Incomplete list of encodings, using SAS nomenclature:
  110: # https://support.sas.com/documentation/onlinedoc/dfdmstudio/2.6/dmpdmsug/Content/dfU_Encodings_SAS.html
  111: # corresponding to the Python documentation of standard encodings
  112: # https://docs.python.org/3/library/codecs.html#standard-encodings
  113: encoding_names: Final = {
  114:     20: "utf-8",
  115:     29: "latin1",
  116:     30: "latin2",
  117:     31: "latin3",
  118:     32: "latin4",
  119:     33: "cyrillic",
  120:     34: "arabic",
  121:     35: "greek",
  122:     36: "hebrew",
  123:     37: "latin5",
  124:     38: "latin6",
  125:     39: "cp874",
  126:     40: "latin9",
  127:     41: "cp437",
  128:     42: "cp850",
  129:     43: "cp852",
  130:     44: "cp857",
  131:     45: "cp858",
  132:     46: "cp862",
  133:     47: "cp864",
  134:     48: "cp865",
  135:     49: "cp866",
  136:     50: "cp869",
  137:     51: "cp874",
  138:     # 52: "",  # not found
  139:     # 53: "",  # not found
  140:     # 54: "",  # not found
  141:     55: "cp720",
  142:     56: "cp737",
  143:     57: "cp775",
  144:     58: "cp860",
  145:     59: "cp863",
  146:     60: "cp1250",
  147:     61: "cp1251",
  148:     62: "cp1252",
  149:     63: "cp1253",
  150:     64: "cp1254",
  151:     65: "cp1255",
  152:     66: "cp1256",
  153:     67: "cp1257",
  154:     68: "cp1258",
  155:     118: "cp950",
  156:     # 119: "",  # not found
  157:     123: "big5",
  158:     125: "gb2312",
  159:     126: "cp936",
  160:     134: "euc_jp",
  161:     136: "cp932",
  162:     138: "shift_jis",
  163:     140: "euc-kr",
  164:     141: "cp949",
  165:     227: "latin8",
  166:     # 228: "", # not found
  167:     # 229: ""  # not found
  168: }
  169: 
  170: 
  171: class SASIndex:
  172:     row_size_index: Final = 0
  173:     column_size_index: Final = 1
  174:     subheader_counts_index: Final = 2
  175:     column_text_index: Final = 3
  176:     column_name_index: Final = 4
  177:     column_attributes_index: Final = 5
  178:     format_and_label_index: Final = 6
  179:     column_list_index: Final = 7
  180:     data_subheader_index: Final = 8
  181: 
  182: 
  183: subheader_signature_to_index: Final = {
  184:     b"\xF7\xF7\xF7\xF7": SASIndex.row_size_index,
  185:     b"\x00\x00\x00\x00\xF7\xF7\xF7\xF7": SASIndex.row_size_index,
  186:     b"\xF7\xF7\xF7\xF7\x00\x00\x00\x00": SASIndex.row_size_index,
  187:     b"\xF7\xF7\xF7\xF7\xFF\xFF\xFB\xFE": SASIndex.row_size_index,
  188:     b"\xF6\xF6\xF6\xF6": SASIndex.column_size_index,
  189:     b"\x00\x00\x00\x00\xF6\xF6\xF6\xF6": SASIndex.column_size_index,
  190:     b"\xF6\xF6\xF6\xF6\x00\x00\x00\x00": SASIndex.column_size_index,
  191:     b"\xF6\xF6\xF6\xF6\xFF\xFF\xFB\xFE": SASIndex.column_size_index,
  192:     b"\x00\xFC\xFF\xFF": SASIndex.subheader_counts_index,
  193:     b"\xFF\xFF\xFC\x00": SASIndex.subheader_counts_index,
  194:     b"\x00\xFC\xFF\xFF\xFF\xFF\xFF\xFF": SASIndex.subheader_counts_index,
  195:     b"\xFF\xFF\xFF\xFF\xFF\xFF\xFC\x00": SASIndex.subheader_counts_index,
  196:     b"\xFD\xFF\xFF\xFF": SASIndex.column_text_index,
  197:     b"\xFF\xFF\xFF\xFD": SASIndex.column_text_index,
  198:     b"\xFD\xFF\xFF\xFF\xFF\xFF\xFF\xFF": SASIndex.column_text_index,
  199:     b"\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFD": SASIndex.column_text_index,
  200:     b"\xFF\xFF\xFF\xFF": SASIndex.column_name_index,
  201:     b"\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF": SASIndex.column_name_index,
  202:     b"\xFC\xFF\xFF\xFF": SASIndex.column_attributes_index,
  203:     b"\xFF\xFF\xFF\xFC": SASIndex.column_attributes_index,
  204:     b"\xFC\xFF\xFF\xFF\xFF\xFF\xFF\xFF": SASIndex.column_attributes_index,
  205:     b"\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFC": SASIndex.column_attributes_index,
  206:     b"\xFE\xFB\xFF\xFF": SASIndex.format_and_label_index,
  207:     b"\xFF\xFF\xFB\xFE": SASIndex.format_and_label_index,
  208:     b"\xFE\xFB\xFF\xFF\xFF\xFF\xFF\xFF": SASIndex.format_and_label_index,
  209:     b"\xFF\xFF\xFF\xFF\xFF\xFF\xFB\xFE": SASIndex.format_and_label_index,
  210:     b"\xFE\xFF\xFF\xFF": SASIndex.column_list_index,
  211:     b"\xFF\xFF\xFF\xFE": SASIndex.column_list_index,
  212:     b"\xFE\xFF\xFF\xFF\xFF\xFF\xFF\xFF": SASIndex.column_list_index,
  213:     b"\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFE": SASIndex.column_list_index,
  214: }
  215: 
  216: 
  217: # List of frequently used SAS date and datetime formats
  218: # http://support.sas.com/documentation/cdl/en/etsug/60372/HTML/default/viewer.htm#etsug_intervals_sect009.htm
  219: # https://github.com/epam/parso/blob/master/src/main/java/com/epam/parso/impl/SasFileConstants.java
  220: sas_date_formats: Final = (
  221:     "DATE",
  222:     "DAY",
  223:     "DDMMYY",
  224:     "DOWNAME",
  225:     "JULDAY",
  226:     "JULIAN",
  227:     "MMDDYY",
  228:     "MMYY",
  229:     "MMYYC",
  230:     "MMYYD",
  231:     "MMYYP",
  232:     "MMYYS",
  233:     "MMYYN",
  234:     "MONNAME",
  235:     "MONTH",
  236:     "MONYY",
  237:     "QTR",
  238:     "QTRR",
  239:     "NENGO",
  240:     "WEEKDATE",
  241:     "WEEKDATX",
  242:     "WEEKDAY",
  243:     "WEEKV",
  244:     "WORDDATE",
  245:     "WORDDATX",
  246:     "YEAR",
  247:     "YYMM",
  248:     "YYMMC",
  249:     "YYMMD",
  250:     "YYMMP",
  251:     "YYMMS",
  252:     "YYMMN",
  253:     "YYMON",
  254:     "YYMMDD",
  255:     "YYQ",
  256:     "YYQC",
  257:     "YYQD",
  258:     "YYQP",
  259:     "YYQS",
  260:     "YYQN",
  261:     "YYQR",
  262:     "YYQRC",
  263:     "YYQRD",
  264:     "YYQRP",
  265:     "YYQRS",
  266:     "YYQRN",
  267:     "YYMMDDP",
  268:     "YYMMDDC",
  269:     "E8601DA",
  270:     "YYMMDDN",
  271:     "MMDDYYC",
  272:     "MMDDYYS",
  273:     "MMDDYYD",
  274:     "YYMMDDS",
  275:     "B8601DA",
  276:     "DDMMYYN",
  277:     "YYMMDDD",
  278:     "DDMMYYB",
  279:     "DDMMYYP",
  280:     "MMDDYYP",
  281:     "YYMMDDB",
  282:     "MMDDYYN",
  283:     "DDMMYYC",
  284:     "DDMMYYD",
  285:     "DDMMYYS",
  286:     "MINGUO",
  287: )
  288: 
  289: sas_datetime_formats: Final = (
  290:     "DATETIME",
  291:     "DTWKDATX",
  292:     "B8601DN",
  293:     "B8601DT",
  294:     "B8601DX",
  295:     "B8601DZ",
  296:     "B8601LX",
  297:     "E8601DN",
  298:     "E8601DT",
  299:     "E8601DX",
  300:     "E8601DZ",
  301:     "E8601LX",
  302:     "DATEAMPM",
  303:     "DTDATE",
  304:     "DTMONYY",
  305:     "DTMONYY",
  306:     "DTWKDATX",
  307:     "DTYEAR",
  308:     "TOD",
  309:     "MDYAMPM",
  310: )
