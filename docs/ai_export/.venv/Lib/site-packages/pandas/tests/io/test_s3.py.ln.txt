    1: from io import BytesIO
    2: 
    3: import pytest
    4: 
    5: from pandas import read_csv
    6: 
    7: 
    8: def test_streaming_s3_objects():
    9:     # GH17135
   10:     # botocore gained iteration support in 1.10.47, can now be used in read_*
   11:     pytest.importorskip("botocore", minversion="1.10.47")
   12:     from botocore.response import StreamingBody
   13: 
   14:     data = [b"foo,bar,baz\n1,2,3\n4,5,6\n", b"just,the,header\n"]
   15:     for el in data:
   16:         body = StreamingBody(BytesIO(el), content_length=len(el))
   17:         read_csv(body)
   18: 
   19: 
   20: @pytest.mark.single_cpu
   21: def test_read_without_creds_from_pub_bucket(s3_public_bucket_with_data, s3so):
   22:     # GH 34626
   23:     pytest.importorskip("s3fs")
   24:     result = read_csv(
   25:         f"s3://{s3_public_bucket_with_data.name}/tips.csv",
   26:         nrows=3,
   27:         storage_options=s3so,
   28:     )
   29:     assert len(result) == 3
   30: 
   31: 
   32: @pytest.mark.single_cpu
   33: def test_read_with_creds_from_pub_bucket(s3_public_bucket_with_data, s3so):
   34:     # Ensure we can read from a public bucket with credentials
   35:     # GH 34626
   36:     pytest.importorskip("s3fs")
   37:     df = read_csv(
   38:         f"s3://{s3_public_bucket_with_data.name}/tips.csv",
   39:         nrows=5,
   40:         header=None,
   41:         storage_options=s3so,
   42:     )
   43:     assert len(df) == 5
