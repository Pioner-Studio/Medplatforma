    1: from io import (
    2:     BytesIO,
    3:     StringIO,
    4: )
    5: 
    6: import pytest
    7: 
    8: import pandas as pd
    9: import pandas._testing as tm
   10: 
   11: pytest.importorskip("tabulate")
   12: 
   13: 
   14: def test_simple():
   15:     buf = StringIO()
   16:     df = pd.DataFrame([1, 2, 3])
   17:     df.to_markdown(buf=buf)
   18:     result = buf.getvalue()
   19:     assert (
   20:         result == "|    |   0 |\n|---:|----:|\n|  0 |   1 |\n|  1 |   2 |\n|  2 |   3 |"
   21:     )
   22: 
   23: 
   24: def test_empty_frame():
   25:     buf = StringIO()
   26:     df = pd.DataFrame({"id": [], "first_name": [], "last_name": []}).set_index("id")
   27:     df.to_markdown(buf=buf)
   28:     result = buf.getvalue()
   29:     assert result == (
   30:         "| id   | first_name   | last_name   |\n"
   31:         "|------|--------------|-------------|"
   32:     )
   33: 
   34: 
   35: def test_other_tablefmt():
   36:     buf = StringIO()
   37:     df = pd.DataFrame([1, 2, 3])
   38:     df.to_markdown(buf=buf, tablefmt="jira")
   39:     result = buf.getvalue()
   40:     assert result == "||    ||   0 ||\n|  0 |   1 |\n|  1 |   2 |\n|  2 |   3 |"
   41: 
   42: 
   43: def test_other_headers():
   44:     buf = StringIO()
   45:     df = pd.DataFrame([1, 2, 3])
   46:     df.to_markdown(buf=buf, headers=["foo", "bar"])
   47:     result = buf.getvalue()
   48:     assert result == (
   49:         "|   foo |   bar |\n|------:|------:|\n|     0 "
   50:         "|     1 |\n|     1 |     2 |\n|     2 |     3 |"
   51:     )
   52: 
   53: 
   54: def test_series():
   55:     buf = StringIO()
   56:     s = pd.Series([1, 2, 3], name="foo")
   57:     s.to_markdown(buf=buf)
   58:     result = buf.getvalue()
   59:     assert result == (
   60:         "|    |   foo |\n|---:|------:|\n|  0 |     1 "
   61:         "|\n|  1 |     2 |\n|  2 |     3 |"
   62:     )
   63: 
   64: 
   65: def test_no_buf():
   66:     df = pd.DataFrame([1, 2, 3])
   67:     result = df.to_markdown()
   68:     assert (
   69:         result == "|    |   0 |\n|---:|----:|\n|  0 |   1 |\n|  1 |   2 |\n|  2 |   3 |"
   70:     )
   71: 
   72: 
   73: @pytest.mark.parametrize("index", [True, False])
   74: def test_index(index):
   75:     # GH 32667
   76: 
   77:     df = pd.DataFrame([1, 2, 3])
   78: 
   79:     result = df.to_markdown(index=index)
   80: 
   81:     if index:
   82:         expected = (
   83:             "|    |   0 |\n|---:|----:|\n|  0 |   1 |\n|  1 |   2 |\n|  2 |   3 |"
   84:         )
   85:     else:
   86:         expected = "|   0 |\n|----:|\n|   1 |\n|   2 |\n|   3 |"
   87:     assert result == expected
   88: 
   89: 
   90: def test_showindex_disallowed_in_kwargs():
   91:     # GH 32667; disallowing showindex in kwargs enforced in 2.0
   92:     df = pd.DataFrame([1, 2, 3])
   93:     with pytest.raises(ValueError, match="Pass 'index' instead of 'showindex"):
   94:         df.to_markdown(index=True, showindex=True)
   95: 
   96: 
   97: def test_markdown_pos_args_deprecatation():
   98:     # GH-54229
   99:     df = pd.DataFrame({"a": [1, 2, 3]})
  100:     msg = (
  101:         r"Starting with pandas version 3.0 all arguments of to_markdown except for the "
  102:         r"argument 'buf' will be keyword-only."
  103:     )
  104:     with tm.assert_produces_warning(FutureWarning, match=msg):
  105:         buffer = BytesIO()
  106:         df.to_markdown(buffer, "grid")
