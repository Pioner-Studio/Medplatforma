    1: import re
    2: 
    3: import numpy as np
    4: import pytest
    5: 
    6: from pandas import (
    7:     DataFrame,
    8:     MultiIndex,
    9: )
   10: 
   11: 
   12: class TestDataFrameDelItem:
   13:     def test_delitem(self, float_frame):
   14:         del float_frame["A"]
   15:         assert "A" not in float_frame
   16: 
   17:     def test_delitem_multiindex(self):
   18:         midx = MultiIndex.from_product([["A", "B"], [1, 2]])
   19:         df = DataFrame(np.random.default_rng(2).standard_normal((4, 4)), columns=midx)
   20:         assert len(df.columns) == 4
   21:         assert ("A",) in df.columns
   22:         assert "A" in df.columns
   23: 
   24:         result = df["A"]
   25:         assert isinstance(result, DataFrame)
   26:         del df["A"]
   27: 
   28:         assert len(df.columns) == 2
   29: 
   30:         # A still in the levels, BUT get a KeyError if trying
   31:         # to delete
   32:         assert ("A",) not in df.columns
   33:         with pytest.raises(KeyError, match=re.escape("('A',)")):
   34:             del df[("A",)]
   35: 
   36:         # behavior of dropped/deleted MultiIndex levels changed from
   37:         # GH 2770 to GH 19027: MultiIndex no longer '.__contains__'
   38:         # levels which are dropped/deleted
   39:         assert "A" not in df.columns
   40:         with pytest.raises(KeyError, match=re.escape("('A',)")):
   41:             del df["A"]
   42: 
   43:     def test_delitem_corner(self, float_frame):
   44:         f = float_frame.copy()
   45:         del f["D"]
   46:         assert len(f.columns) == 3
   47:         with pytest.raises(KeyError, match=r"^'D'$"):
   48:             del f["D"]
   49:         del f["B"]
   50:         assert len(f.columns) == 2
   51: 
   52:     def test_delitem_col_still_multiindex(self):
   53:         arrays = [["a", "b", "c", "top"], ["", "", "", "OD"], ["", "", "", "wx"]]
   54: 
   55:         tuples = sorted(zip(*arrays))
   56:         index = MultiIndex.from_tuples(tuples)
   57: 
   58:         df = DataFrame(np.random.default_rng(2).standard_normal((3, 4)), columns=index)
   59:         del df[("a", "", "")]
   60:         assert isinstance(df.columns, MultiIndex)
