    1: import gc
    2: 
    3: import numpy as np
    4: import pytest
    5: 
    6: from pandas import (
    7:     DataFrame,
    8:     to_datetime,
    9: )
   10: 
   11: 
   12: @pytest.fixture(autouse=True)
   13: def mpl_cleanup():
   14:     # matplotlib/testing/decorators.py#L24
   15:     # 1) Resets units registry
   16:     # 2) Resets rc_context
   17:     # 3) Closes all figures
   18:     mpl = pytest.importorskip("matplotlib")
   19:     mpl_units = pytest.importorskip("matplotlib.units")
   20:     plt = pytest.importorskip("matplotlib.pyplot")
   21:     orig_units_registry = mpl_units.registry.copy()
   22:     with mpl.rc_context():
   23:         mpl.use("template")
   24:         yield
   25:     mpl_units.registry.clear()
   26:     mpl_units.registry.update(orig_units_registry)
   27:     plt.close("all")
   28:     # https://matplotlib.org/stable/users/prev_whats_new/whats_new_3.6.0.html#garbage-collection-is-no-longer-run-on-figure-close  # noqa: E501
   29:     gc.collect(1)
   30: 
   31: 
   32: @pytest.fixture
   33: def hist_df():
   34:     n = 50
   35:     rng = np.random.default_rng(10)
   36:     gender = rng.choice(["Male", "Female"], size=n)
   37:     classroom = rng.choice(["A", "B", "C"], size=n)
   38: 
   39:     hist_df = DataFrame(
   40:         {
   41:             "gender": gender,
   42:             "classroom": classroom,
   43:             "height": rng.normal(66, 4, size=n),
   44:             "weight": rng.normal(161, 32, size=n),
   45:             "category": rng.integers(4, size=n),
   46:             "datetime": to_datetime(
   47:                 rng.integers(
   48:                     812419200000000000,
   49:                     819331200000000000,
   50:                     size=n,
   51:                     dtype=np.int64,
   52:                 )
   53:             ),
   54:         }
   55:     )
   56:     return hist_df
