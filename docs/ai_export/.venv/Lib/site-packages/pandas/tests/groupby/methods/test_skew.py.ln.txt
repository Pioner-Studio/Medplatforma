    1: import numpy as np
    2: 
    3: import pandas as pd
    4: import pandas._testing as tm
    5: 
    6: 
    7: def test_groupby_skew_equivalence():
    8:     # Test that that groupby skew method (which uses libgroupby.group_skew)
    9:     #  matches the results of operating group-by-group (which uses nanops.nanskew)
   10:     nrows = 1000
   11:     ngroups = 3
   12:     ncols = 2
   13:     nan_frac = 0.05
   14: 
   15:     arr = np.random.default_rng(2).standard_normal((nrows, ncols))
   16:     arr[np.random.default_rng(2).random(nrows) < nan_frac] = np.nan
   17: 
   18:     df = pd.DataFrame(arr)
   19:     grps = np.random.default_rng(2).integers(0, ngroups, size=nrows)
   20:     gb = df.groupby(grps)
   21: 
   22:     result = gb.skew()
   23: 
   24:     grpwise = [grp.skew().to_frame(i).T for i, grp in gb]
   25:     expected = pd.concat(grpwise, axis=0)
   26:     expected.index = expected.index.astype(result.index.dtype)  # 32bit builds
   27:     tm.assert_frame_equal(result, expected)
