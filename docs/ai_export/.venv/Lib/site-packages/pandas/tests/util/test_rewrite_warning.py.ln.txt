    1: import warnings
    2: 
    3: import pytest
    4: 
    5: from pandas.util._exceptions import rewrite_warning
    6: 
    7: import pandas._testing as tm
    8: 
    9: 
   10: @pytest.mark.parametrize(
   11:     "target_category, target_message, hit",
   12:     [
   13:         (FutureWarning, "Target message", True),
   14:         (FutureWarning, "Target", True),
   15:         (FutureWarning, "get mess", True),
   16:         (FutureWarning, "Missed message", False),
   17:         (DeprecationWarning, "Target message", False),
   18:     ],
   19: )
   20: @pytest.mark.parametrize(
   21:     "new_category",
   22:     [
   23:         None,
   24:         DeprecationWarning,
   25:     ],
   26: )
   27: def test_rewrite_warning(target_category, target_message, hit, new_category):
   28:     new_message = "Rewritten message"
   29:     if hit:
   30:         expected_category = new_category if new_category else target_category
   31:         expected_message = new_message
   32:     else:
   33:         expected_category = FutureWarning
   34:         expected_message = "Target message"
   35:     with tm.assert_produces_warning(expected_category, match=expected_message):
   36:         with rewrite_warning(
   37:             target_message, target_category, new_message, new_category
   38:         ):
   39:             warnings.warn(message="Target message", category=FutureWarning)
