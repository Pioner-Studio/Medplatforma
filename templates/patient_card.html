{% extends 'base.html' %}
{% block title %}–ü–∞—Ü–∏–µ–Ω—Ç ‚Äî {{ patient.full_name }}{% endblock %}
{% block content %}
<div style="max-width:780px; margin:0 auto; background:#fff; border-radius:24px; box-shadow:0 6px 32px rgba(20,40,80,.08); padding:38px 42px;">
    <div style="display:flex; align-items:center; gap:34px; margin-bottom:32px;">
        <img src="{{ patient.avatar_url }}" alt="avatar" style="width:102px; height:102px; border-radius:50%; object-fit:cover; box-shadow:0 2px 10px rgba(20,40,80,.11);">
        <div>
            <div style="font-size:2rem; font-weight:700; margin-bottom:4px;">{{ patient.full_name }}</div>
            <div style="color:#5b6b7b; font-size:1.1rem;">
                {{ patient.dob }}
                {% if patient.age %} ({{ patient.age }} –ª–µ—Ç){% endif %}
            </div>
            <div style="margin:10px 0 6px 0; color:#2236a7;">
                <span style="margin-right:20px;">üìû {{ patient.phone }}</span>
                <span>‚úâÔ∏è {{ patient.email }}</span>
            </div>
        </div>
        <div style="margin-left:auto; text-align:right;">
            <button onclick="window.location.href='/edit_patient/{{ patient._id }}'" style="background:#445be2; color:#fff; border:none; border-radius:10px; padding:9px 22px; font-weight:600; font-size:1rem; cursor:pointer; margin-bottom:8px;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button><br>
            <button onclick="window.location.href='/add_payment/{{ patient._id }}'" style="background:#13b949; color:#fff; border:none; border-radius:10px; padding:9px 22px; font-weight:600; font-size:1rem; cursor:pointer;">+ –î–æ–±–∞–≤–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
        </div>
    </div>
    <div style="display:flex; gap:40px;">
        <div style="flex:1;">
            <div style="font-weight:600; color:#445be2; margin-bottom:8px;">–§–∏–Ω–∞–Ω—Å—ã</div>
            <div style="margin-bottom:8px; font-size:1.14rem;">
                –û–ø–ª–∞—á–µ–Ω–æ: <span style="color:#13b949; font-weight:700;">{{ patient.total_paid }} ‚ÇΩ</span>
            </div>
            <div style="font-size:1.11rem;">
                –î–æ–ª–≥: <span style="color:{% if patient.debt > 0 %}#d91f3c{% else %}#13b949{% endif %}; font-weight:700;">
                    {{ patient.debt if patient.debt else '–ù–µ—Ç' }} ‚ÇΩ
                </span>
            </div>
            {% if patient.notes %}
            <div style="margin-top:18px; font-size:1.04rem; background:#f6f8fd; border-radius:10px; padding:12px;">
                <b>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</b> {{ patient.notes }}
            </div>
            {% endif %}
        </div>
        <div style="flex:2;">
            <div style="font-weight:600; color:#445be2; margin-bottom:8px;">–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏—ë–º–æ–≤</div>
            <table style="width:100%; background:#fff; border-radius:10px; font-size:1.08rem;">
                <thead style="background:#f2f6ff;">
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–í—Ä–∞—á</th>
                        <th>–£—Å–ª—É–≥–∞</th>
                        <th>–°—É–º–º–∞</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for appt in patient.appointments %}
                    <tr style="border-bottom:1px solid #f0f0f0;">
                        <td>{{ appt.datetime[:10] }}</td>
                        <td>
                            <a href="/doctor/{{ appt.doctor_id }}" style="color:#2236a7; text-decoration:none;">{{ appt.doctor_name }}</a>
                        </td>
                        <td>{{ appt.service }}</td>
                        <td>{{ appt.sum }} ‚ÇΩ</td>
                        <td></td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" style="text-align:center; color:#aaa; padding:14px;">–ù–µ—Ç –ø–æ—Å–µ—â–µ–Ω–∏–π</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
