{% extends "base.html" %}

{% block title %}–ö–∞—Å—Å–∞ - –ú–µ–¥–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <h1 class="mb-4">–ö–∞—Å—Å–∞</h1>

  <!-- –ë–∞–ª–∞–Ω—Å—ã –∫–∞—Å—Å -->
  <div class="mb-4">
    <h2 class="h5 text-muted mb-3">–¢–µ–∫—É—â–∏–µ –±–∞–ª–∞–Ω—Å—ã</h2>
    <div class="row g-3">
      {% for cb in (cashboxes or []) %}
      <div class="col-md-4">
        <div class="card shadow-sm" style="background: {% if cb.balance >= 0 %}linear-gradient(135deg, #667eea 0%, #764ba2 100%){% else %}linear-gradient(135deg, #f093fb 0%, #f5576c 100%){% endif %}; color: white; border: none; border-radius: 12px;">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div style="opacity: 0.9;">{{ cb.name }}</div>
              <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; background: rgba(255,255,255,0.2);">
                <span style="font-size: 20px;">{% if cb.balance >= 0 %}üí∞{% else %}‚ö†Ô∏è{% endif %}</span>
              </div>
            </div>
            <div class="h2 fw-bold mb-1">{{ "{:,}".format(cb.balance).replace(',', ' ') }} ‚ÇΩ</div>
            <small style="opacity: 0.8;">{% if cb.balance >= 0 %}–í –Ω–∞–ª–∏—á–∏–∏{% else %}–ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥{% endif %}</small>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="text-muted small mb-2">–î–æ—Ö–æ–¥—ã</div>
          <div class="h3 fw-bold text-success mb-0">{{ "{:,}".format(income|default(0)).replace(',', ' ') }} ‚ÇΩ</div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="text-muted small mb-2">–†–∞—Å—Ö–æ–¥—ã</div>
          <div class="h3 fw-bold text-danger mb-0">{{ "{:,}".format(expense|default(0)).replace(',', ' ') }} ‚ÇΩ</div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º -->
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <h3 class="h6 fw-semibold mb-3">–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º</h3>
      <div class="d-flex gap-2 flex-wrap">
        <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 rounded-pill fw-normal">
          –ê–ª—å—Ñ–∞ ‚Äî {{ by_source.alpha|default(0) }} ‚ÇΩ
        </span>
        <span class="badge bg-success bg-opacity-10 text-success px-3 py-2 rounded-pill fw-normal">
          –°–±–µ—Ä ‚Äî {{ by_source.sber|default(0) }} ‚ÇΩ
        </span>
        <span class="badge bg-warning bg-opacity-10 text-warning px-3 py-2 rounded-pill fw-normal">
          –ù–∞–ª ‚Äî {{ by_source.cash|default(0) }} ‚ÇΩ
        </span>
      </div>
    </div>
  </div>

  <!-- –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h3 class="h6 fw-semibold mb-3">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
      {% set CAT_RU = {"purchase":"–ó–∞–∫—É–ø–∫–∞","marketing":"–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥","dividends":"–î–∏–≤–∏–¥–µ–Ω–¥—ã","rent":"–ê—Ä–µ–Ω–¥–∞","other":"–î—Ä—É–≥–∏–µ —Ä–∞—Å—Ö–æ–¥—ã"} %}

      {% if by_category %}
        <div class="d-flex gap-2 flex-wrap">
          {% for cat, sum in by_category.items() %}
          <a href="/finance?type=expense&category={{ cat }}"
             class="badge bg-light text-dark px-3 py-2 rounded-pill text-decoration-none border">
            {{ CAT_RU.get(cat,cat) }} ‚Äî {{ sum }} ‚ÇΩ
          </a>
          {% endfor %}
        </div>
      {% else %}
        <span class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
      {% endif %}

      <hr class="my-3">
      <a href="/finance?type=expense" class="text-primary text-decoration-none fw-semibold">–í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã ‚Üí</a>
    </div>
  </div>
</div>
{% endblock %}
